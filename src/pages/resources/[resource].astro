---
import Link from "~/components/Link.astro";
import BaseLayout from "~/layouts/BaseLayout.astro";
import contentfulClient from "~/lib/contentful";

export const resourceTypes: string[] = ["articles", "videos"];

export function getStaticPaths() {
  return resourceTypes.map((resource) => ({ params: { resource } }));
}

const { resource } = Astro.params;
const { pathname } = Astro.url;

let { items } = await contentfulClient.getAssets();

let assets = items.filter(({ fields }) =>
  fields.description.includes("youtube"),
);

if (resource === "articles") {
  assets = items.filter(
    ({ fields: { description } }) =>
      description.includes("medium") || description.includes("ghost"),
  );
}
---

<BaseLayout>
  <div class="my-6 flex items-end justify-between">
    <div class="flex flex-col space-y-2">
      <h1 class="text-3xl">Resources</h1>
      <span class="text-neutral-400"
        >Explore recent articles, videos and podcasts about Fuel</span
      >
    </div>
    <div class="flex space-x-2">
      {
        resourceTypes.map((resourceType) => (
          <Link
            href={`/resources/${resourceType}`}
            class:list={[
              "rounded-md border-[0.1px] border-teal-200/20 px-2 py-1 text-center text-sm capitalize",
              {
                "bg-teal-600": pathname.endsWith(resourceType),
              },
            ]}
          >
            {resourceType}
          </Link>
        ))
      }
    </div>
  </div>
  <ul
    class="grid grid-cols-1 gap-4 sm:grid-cols-3 md:grid-cols-4 2xl:grid-cols-5"
  >
    {
      assets.map((asset) => (
        <li
          class:list={[
            "mx-auto duration-400 flex max-w-[280px] flex-col justify-between",
            "rounded-xl border-[0.1px] border-teal-200/20",
            "hover:bg-teal-800/10",
          ]}
        >
          <Link external href={asset.fields.description}>
            <img
              src={`https:${asset.fields.file.url}`}
              class="overflow-hidden rounded-t-xl"
            />
            <p class="m-4 text-sm text-neutral-300 line-clamp-2">
              {asset.fields.title}
            </p>
            <div class="flex justify-between px-3 py-2">
              <div />
            </div>
          </Link>
        </li>
      ))
    }
  </ul>
</BaseLayout>
